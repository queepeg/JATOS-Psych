<!doctype html>
<html>
  <head>
    <title>MSJH</title>
      <script src="/assets/javascripts/jatos.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
      <script src="/study_assets/MSJH/jspsych-5.0.3/jspsych.js"></script>
	  <script src="/study_assets/MSJH/jspsych-5.0.3/plugins/jspsych-text.js"></script>
      <script src="/study_assets/MSJH/jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
	  <script src="/study_assets/MSJH/jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
	  <link href="/study_assets/MSJH/jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  <script>

  /* create the experiment timeline */
  var timeline = [];
  var wordColor;

  /* instructions and practice text */
  var instructions = {
    type: 'instructions',
    pages: ["<p>You will be presented with three red words and three blue words.  You will then see a red or blue box.</p>" +
    "<p style=" + "font-weight:bold;" + ">Press Y if the word was shown on the previous screen</p>" +
    "<p style=" + "font-weight:bold;" + ">Press N if the word was NOT shown on the previous screen</p>" +
    "<p>Click the button below to begin with some practice rounds</p>"
    ],
    allow_keys: false,
    show_clickable_nav: true
  };

      timeline.push(instructions);

    /* instructions repeated at end of practice round*/

  var endPractice = {
    type: 'endPractice',
    pages: ["<p>You have completed the practice rounds.  You will be presented with three red words and three blue words.  You will then see a red or blue box.</p>" +
    "<p style=" + "font-weight:bold;" + ">Press Y if the word was shown on the previous screen</p>" +
    "<p style=" + "font-weight:bold;" + ">Press N if the word was NOT shown on the previous screen</p>" +
    "<p>Click the button below to begin</p>"
    ],
    allow_keys: false,
    show_clickable_nav: true
  };


//present fixation cross for 500ms
var fixation = {
    type: 'single-stim',
    stimulus: "/study_assets/MSJH/img/fixation.png",
    timing_post_trial: 0,
	timing_stim: 500,
	timing_response: 500,
    response_ends_trial: false
};


timeline.push(fixation);

	var learningScreen = {
    type: 'single-stim',
	stimulus: function() {

	// Array of words to be used
	var positiveArray = ["smile","joy","triumph","love","peace"];
	var negativeArray = ["hate","war","death","decay","violence"];
	var mixedArray = ["red","green","yellow","purple","black", "white", "orange", "pink"];

	// Array of colors to be used and randomised
	var intColor = Math.floor(Math.random() * 100);

	if (intColor < 50) {
		var randomColor = "Red";
		var altColor = "Blue";
    } else {
		var randomColor = "Blue";
		var altColor = "Red";
    }

	//Array to slice the words
	stimPArray = jsPsych.randomization.sample(positiveArray, 3, false);
	stimNArray = jsPsych.randomization.sample(negativeArray, 3, false);
	stimMArray = jsPsych.randomization.sample(mixedArray, 6, false);

	//position code
	var intPos = Math.floor(Math.random() * 100);

    if (intPos < 21) {
        wordColor = "Mixed";
        // console.log("intPos=" + intPos.toString() + " wordColor=" + wordColor);

        var returnValue = "<div class=" + randomColor + "><div class=topLeft>" + stimMArray[0] + "</div><div class=topMiddle>" + stimMArray[1] + "</div><div class=topRight>" + stimMArray[2] + "</div></div>" + "<div class=" + altColor + "><div class=bottomLeft>" + stimMArray[3] + "</div><div class=bottomMiddle>" + stimMArray[4] + "</div><div class=bottomRight>" + stimMArray[5] + "</div></div>";
    } else if (intPos > 60) {
        wordColor = randomColor;
        boolNegativePositive = false;
        // console.log("intPos=" + intPos.toString() + " wordColor=" + wordColor + " boolNegativePositive=" + boolNegativePositive.toString());

	   var returnValue = "<div class=" + randomColor + "><div class=topLeft>" + stimNArray[0] + "</div><div class=topMiddle>" + stimNArray[1] + "</div><div class=topRight>" + stimNArray[2] + "</div></div>" + "<div class=" + altColor + "><div class=bottomLeft>" + stimPArray[0] + "</div><div class=bottomMiddle>" + stimPArray[1] + "</div><div class=bottomRight>" + stimPArray[2] + "</div></div>";
	} else {
        wordColor = randomColor;
        boolNegativePositive = true;
        // console.log("intPos=" + intPos.toString() + " wordColor=" + wordColor + " boolNegativePositive=" + boolNegativePositive.toString());

	   var returnValue = "<div class=" + randomColor + "><div class=topLeft>" + stimPArray[0] + "</div><div class=topMiddle>" + stimPArray[1] + "</div><div class=topRight>" + stimPArray[2] + "</div></div>" + "<div class=" + altColor + "><div class=bottomLeft>" + stimNArray[0] + "</div><div class=bottomMiddle>" + stimNArray[1] + "</div><div class=bottomRight>" + stimNArray[2] + "</div></div>";
  }
    return returnValue;
    },
    is_html: true,
    timing_post_trial: 800,
	timing_stim: 7800,
	timing_response: 7800,
    response_ends_trial: false
};

timeline.push(learningScreen);

var cue = {
    type: 'single-stim',
    stimulus: function() {

//variable to determine colour and array used for current trial
if (typeof boolNegativePositive === "undefined"){
    currentTrial = wordColor;
    console.log("currentTrial=" + currentTrial + " boolNegativePositive is undefined!");
} else {
    currentTrial = wordColor + boolNegativePositive.toString();
    console.log("currentTrial=" + currentTrial + " boolNegativePositive is " + boolNegativePositive.toString());
}
//variable to determine color of cue to be shown

//variable to determine probability of cue color drawn by var cue
var cueRandomColor = Math.floor(Math.random() * 100);

if (currentTrial === "Mixed"){
    // choose randomly between .redCue and .blueCue
    var intCueColor = Math.floor(Math.random() * 100);

	if (intCueColor < 50) {
		cueColor = "RedCue";
    } else {
		cueColor = "BlueCue";
    }

    cueLabel = "random";
} else if (currentTrial === "Redfalse" || currentTrial === "Bluetrue") {
    if (cueRandomColor < 71) {
        cueColor = "BlueCue";
        cueLabel = "posRel";
    } else {
    // else display .redCue
    cueColor = "RedCue";
    cueLabel = "negRel";
    }
} else {
    // (FOR EVERYTHING ELSE)
    if (cueRandomColor < 71) {
    // then display .redCue
    cueColor = "RedCue";
    cueLabel = "posRel";
    } else {
    // display .blueCue
    cueColor = "BlueCue";
    cueLabel = "negRel";
    }
}
// Return the result
return "<div class=" + cueColor + ">" + cueLabel + " " + currentTrial + " " + cueRandomColor.toString() + "</div>";
},
is_html: true
};

timeline.push(cue)

/* Start of ProbeLogic.js code */

var probe = {
    type: 'single-stim',
    stimulus: function() {

        // These need to be inside the probe function or they will get triggered to early.
        oldPositiveWords = [stimPArray[0], stimPArray[1], ;
        oldNegativeWords = [" + stimNArray[0] + "];
        oldMixedWords = [" + stimMArray[0] + "];
        newPositiveWords = ["fantastic", "awesome", "way to go"];
        newNegativeWords = ["poor","unhappy","sad"];
        probeArray = [];
        var probeCategory;
        var completeTrial;

        if (cueLabel === "random"){

            var word = jsPsych.randomization.sample(oldMixedWords, 1, false);
            probeCategory = "random";
            var answer = word[0];
        } else {
            var word = jsPsych.randomization.sample(probeArray, 1, false);
            probeCategory = "probe";
        }

        if (cueLabel === "NegRel"){
            if (probeCategory === "OldNegativeWords"){
                completeTrial = "Relevant";
            } else if (probeCategory === "OldPositiveWords") {
                completeTrial = "Irrelevant";
            } else {
                completeTrial = probeCategory;
            }
        } else if (cueLabel === "PosRel"){
            if (probeCategory === "OldPositiveWords"){
                completeTrial = "Relevant";
            } else if (probeCategory === "OldNegativeWords") {
                completeTrial = "Irrelevant";
            } else {
                completeTrial = probeCategory;
            }
        } else {
            completeTrial = "nonCritical";
        }

        return "<div></div>";
    },
    is_html: true
    };

timeline.push(probe);

/* End of ProbeLogic.js code */

/* round 1 title text */
var round1 = {
    type: 'round1',
    pages: ["<p>Round 1</p>"
    ],
    allow_keys: false,
    show_clickable_nav: false
  };

/* round 2 title text */
var round2 = {
    type: 'round2',
    pages: ["<p>Round 2</p>"
    ],
    allow_keys: false,
    show_clickable_nav: false
  };

/* round 3 title text */
var round3 = {
    type: 'round3',
    pages: ["<p>Round 3</p>"
    ],
    allow_keys: false,
    show_clickable_nav: false
  };


/* thank you message for completing the trial*/
var complete = {
    type: 'complete',
    pages: ["<p>Thank you for completing today's trial</p>"
    ],
    allow_keys: false,
    show_clickable_nav: false
  };


jatos.onLoad(function() {
    jsPsych.init({
        timeline: timeline,

        //Once it has finished send the result data back to Jatos
        on_finish: function() {
            var resultJson = JSON.stringify(jsPsych.data.getData());
            jatos.submitResultData(resultJson, jatos.startNextComponent);
        }
    });
});
    </script>
    </body>
</html>

